;;; my_ligatures.el --- add ligatures support for JetBrains Mono font
;;; Commentary:
;;; This feature is still unstable

;;; Code:

(require 'composite)
(defun setup-ligatures ()
  "Setup JetBrains Mono font ligatures."
  (interactive)
  (let ((alist '((?! . "\\(?:!\\(?:==\\|[!=]\\)\\)")
                 (?# . "\\(?:#\\(?:###?\\|_(\\|[!#(:=?[_{]\\)\\)")
                 (?$ . "\\(?:\\$>\\)")
                 (?& . "\\(?:&&&?\\)")
                 (?* . "\\(?:\\*\\(?:\\*\\*\\|[/>]\\)\\)")
                 (?+ . "\\(?:\\+\\(?:\\+\\+\\|[+>]\\)\\)")
                 (?- . "\\(?:-\\(?:-[>-]\\|<<\\|>>\\|[<>|~-]\\)\\)")
                 (?. . "\\(?:\\.\\(?:\\.[.<]\\|[.=?-]\\)\\)")
                 (?/ . "\\(?:/\\(?:\\*\\*\\|//\\|==\\|[*/=>]\\)\\)")
                 (?: . "\\(?::\\(?:::\\|\\?>\\|[:<-?]\\)\\)")
                 (?\; . "\\(?:;;\\)")
                 (?< . "\\(?:<\\(?:!--\\|\\$>\\|\\*>\\|\\+>\\|-[<>|]\\|/>\\|<[<=-]\\|=\\(?:=>\\|[<=>|]\\)\\||\\(?:||::=\\|[>|]\\)\\|~[>~]\\|[$*+/:<=>|~-]\\)\\)")
                 (?= . "\\(?:=\\(?:!=\\|/=\\|:=\\|=[=>]\\|>>\\|[=>]\\)\\)")
                 (?> . "\\(?:>\\(?:=>\\|>[=>-]\\|[]:=-]\\)\\)")
                 (?? . "\\(?:\\?[.:=?]\\)")
                 (?\[ . "\\(?:\\[\\(?:||]\\|[<|]\\)\\)")
                 (?\ . "\\(?:\\\\/?\\)")
                 (?\] . "\\(?:]#\\)")
                 (?^ . "\\(?:\\^=\\)")
                 (?_ . "\\(?:_\\(?:|?_\\)\\)")
                 (?{ . "\\(?:{|\\)")
                 (?| . "\\(?:|\\(?:->\\|=>\\||\\(?:|>\\|[=>-]\\)\\|[]=>|}-]\\)\\)")
                 (?~ . "\\(?:~\\(?:~>\\|[=>@~-]\\)\\)"))))
    (dolist (char-regexp alist)
      (set-char-table-range composition-function-table (car char-regexp)
                            `([,(cdr char-regexp) 0 font-shape-gstring])))))

(add-hook 'after-init-hook 'setup-ligatures)

(provide 'my_ligatures)
;;; my_ligatures.el ends here
